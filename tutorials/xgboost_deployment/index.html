<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.37.1" />
    <meta name="description" content="Guide to deploy XGBoost Models.">


    <title>Example: XGBoost Deployment :: Clipper</title>
    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/featherlight.min.css" rel="stylesheet">
    <link href="/css/horsey.css" rel="stylesheet">
    
    <link href="/css/theme.css" rel="stylesheet">
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/jquery-2.x.min.js"></script>
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>

    

    

  </head>
  <body class="" data-url="/tutorials/xgboost_deployment/">
    <nav id="sidebar" class="">





<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://clipper.ai">
  <img id="grav-logo" src="/images/clipper-logo.png">
  </img>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="/js/lunr.min.js"></script>
<script type="text/javascript" src="/js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "http:\/\/clipper.ai\/";
</script>
<script type="text/javascript" src="/js/search.js"></script>

    
  </div>

  
    <ul class="topics">
        
            <li data-nav-id="/" class="dd-item">
            <a href="/"><i class="fa fa-fw fa-home"></i></a>
            </li>
        
        
        
          
          


 
  
    
    <li data-nav-id="/about/" class="dd-item 
        
        
        
        ">
      <a href="/about/">
        <span>About</span>

        
        

        
      </a>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/tutorials/" class="dd-item 
        parent
        
        
        ">
      <a href="/tutorials/">
        <span>User Guides</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/tutorials/basic_concepts/" class="dd-item
     
      ">
        <a href="/tutorials/basic_concepts/">
        <span>Basic Concepts</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/xgboost_deployment/" class="dd-item
     active
      ">
        <a href="/tutorials/xgboost_deployment/">
        <span>Example: XGBoost Deployment</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/image_query/" class="dd-item
     
      ">
        <a href="/tutorials/image_query/">
        <span>Example: Querying Clipper with Images</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/container_managers/" class="dd-item
     
      ">
        <a href="/tutorials/container_managers/">
        <span>Container Orchestration</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/r-deployment/" class="dd-item
     
      ">
        <a href="/tutorials/r-deployment/">
        <span>R Deployment</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/metrics/" class="dd-item
     
      ">
        <a href="/tutorials/metrics/">
        <span>Monitoring Clipper Metrics</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/rest/" class="dd-item
     
      ">
        <a href="/tutorials/rest/">
        <span>REST API Documentation</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/custom_model_container/" class="dd-item
     
      ">
        <a href="/tutorials/custom_model_container/">
        <span>Creating a Custom Model Container</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/troubleshooting/" class="dd-item
     
      ">
        <a href="/tutorials/troubleshooting/">
        <span>Troubleshooting</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/support/" class="dd-item 
        
        
        
        ">
      <a href="/support/">
        <span>Support</span>

        
        

        
      </a>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/contributing/" class="dd-item 
        
        
        
        ">
      <a href="/contributing/">
        <span>Contributing</span>

        
        

        
      </a>
              
    </li>
  
 

          
        

        
        <section id="shortcuts">
            
                <li class="" role="">
                    <h3>More</h3>
                    <a href="http://docs.clipper.ai"><i class='fa fa-book'></i> API Docs</a>
                    
                </li>
            
                <li class="" role="">
                    
                    <a href="http://clipper.ai/api/api.html"><i class='fa fa-book'></i> REST API</a>
                    
                </li>
            
                <li class="" role="">
                    
                    <a href="https://github.com/ucbrise/clipper"><i class='fa fa-github'></i> Github repo</a>
                    
                </li>
            
        </section>    
        
        

        
    </ul>
    
     
    <section id="footer">
      <center>

<a class="github-button" href="https://github.com/ucbrise/clipper/archive/master.zip" data-icon="octicon-cloud-download" aria-label="Download ucbrise/clipper on GitHub">Download</a>


<a class="github-button" href="https://github.com/ucbrise/clipper" data-icon="octicon-star" data-show-count="false" aria-label="Star ucbrise/clipper on GitHub">Star</a>


<a class="github-button" href="https://github.com/ucbrise/clipper/fork" data-icon="octicon-repo-forked" data-show-count="false" aria-label="Fork ucbrise/clipper on GitHub">Fork</a>

</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
        
          <div id="top-bar">
            

            <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                  </a>
                </span>
                <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                <span class="links">
                







 <a href='/'>Clipper</a> > <a href='/tutorials/'>User Guides</a> > Example: XGBoost Deployment

 

 

   
                </span>
            </div>
            <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#a-guide-to-deploy-xgboost-models">A guide to deploy XGBoost Models</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

          </div>
        
        
        <div id="body-inner">
          
            <h1>Example: XGBoost Deployment</h1>
          






<h2 id="a-guide-to-deploy-xgboost-models">A guide to deploy XGBoost Models</h2>

<div class="notices warning" ><p>This tutorial will assume that you have already installed <code>clipper_admin</code> and its dependencies.</p>
</div>


<p>In order to keep the base images small, containers limit the packages they come with default; however, Clipper also supports the installation of additional packages onto model containers using pip. Packages such as XGBoost can be installed and deployed in this way.</p>

<p>The following tutorial is written in Python. First, we start Clipper.</p>

<pre><code class="language-python">import logging, xgboost as xgb, numpy as np
from clipper_admin import ClipperConnection, DockerContainerManager
cl = ClipperConnection(DockerContainerManager())
</code></pre>

<p>Next, we must register our application</p>

<pre><code class="language-python"># We will register it to deploy an xgboost model.
cl.register_application('xgboost-test', 'integers', 'default_pred', 100000)
</code></pre>

<p>Now we need to get some training data. For the purposes of this example, we will just use randomly generated data.</p>

<pre><code class="language-python">def get_test_point():
    return [np.random.randint(255) for _ in range(784)]
</code></pre>

<p>We then create an XGBoost model. (These steps will guide you to create a generic model).</p>

<pre><code class="language-python"># Create a training matrix.
dtrain = xgb.DMatrix(get_test_point(), label=[0])
# We then create parameters, watchlist, and specify the number of rounds
# This is code that we use to build our XGBoost Model, and your code may differ.
param = {'max_depth': 2, 'eta': 1, 'silent': 1, 'objective': 'binary:logistic'}
watchlist = [(dtrain, 'train')]
num_round = 2
bst = xgb.train(param, dtrain, num_round, watchlist)
</code></pre>

<p>We also must define our predict function for our model. In order to deploy the XGBoost model to Clipper, we define a closure that references the XGBoost model. Clipper&rsquo;s model deployer will automatically track down everything that is referenced in the closure (including the XGBoost model), and include it in the model container. We loop through every element in the batch to account for Clipper&rsquo;s adaptive batching, which may add duplicates of requests to batches to figure out the optimal batch size for a model container. (For more info on adaptive batching, check out this <a href="https://docs.google.com/presentation/d/12FLuE6HRnindJOxK_iy7pf8piC6SKR3KwDy-eNP0vlg/edit?usp=sharing">link</a>)</p>

<pre><code class="language-python">def predict(xs):
    return bst.predict(xgb.DMatrix(xs))
</code></pre>

<p>Now that we have a model, as well as a predict function, we must deploy our model container. We will use a <code>python_closure_container</code>, and install the <code>xgboost</code> module using <code>pip</code>.</p>

<pre><code class="language-python">from clipper_admin.deployers import python as python_deployer
# We specify which packages to install in the pkgs_to_install arg.
# For example, if we wanted to install xgboost and psycopg2, we would use
# pkgs_to_install = ['xgboost', 'psycopg2']
python_deployer.deploy_python_closure(cl, name='xgboost-model', version=1,
     input_type=&quot;integers&quot;, func=predict, pkgs_to_install=['xgboost'])
</code></pre>

<p>The next step is to link the model container to our app, so that Clipper can route requests for the &ldquo;xgboost-test&rdquo; application to the &ldquo;xgboost-model&rdquo; container.</p>

<pre><code class="language-python">cl.link_model_to_app('xgboost-test', 'xgboost-model')
</code></pre>

<p>Now your application is ready to serve predictions. Let&rsquo;s try one!</p>

<pre><code class="language-python">import requests, json
# Get Address
addr = cl.get_query_addr()
# Post Query
response = requests.post(
     &quot;http://%s/%s/predict&quot; % (addr, 'xgboost-test'),
     headers={&quot;Content-type&quot;: &quot;application/json&quot;},
     data=json.dumps({
         'input': get_test_point()
     }))
result = response.json()
if response.status_code == requests.codes.ok and result[&quot;default&quot;]:
     print('A default prediction was returned.')
     elif response.status_code != requests.codes.ok:
         print(result)
         raise BenchmarkException(response.text)
     else:
         print('Prediction Returned:', result)
</code></pre>

<p>You should see something like the following output:</p>

<pre><code class="language-python">('Prediction Returned:', {u'default': False, u'output': [0.5], u'query_id': 26})
</code></pre>

<p>And finally, we stop Clipper</p>

<pre><code class="language-python">cl.stop_all()
</code></pre>


<footer class=" footline" >
	
</footer>




        

      </div>
    </div>

    
 
    

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/tutorials/basic_concepts/" title="Basic Concepts"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/tutorials/image_query/" title="Example: Querying Clipper with Images" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>    

    <script src="/js/clipboard.min.js"></script>
<script src="/js/featherlight.min.js"></script>
<script src="/js/html5shiv-printshiv.min.js"></script>
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/js/modernizr.custom.71422.js"></script>
<script src="/js/learn.js"></script>
<script src="/js/hugo-learn.js"></script>


<link href="/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
<script src="/mermaid/mermaid.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
    

  </body>
</html>

